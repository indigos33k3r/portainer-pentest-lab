# portainer-pentest-lab


## Abstract

This lab is built using [Portainer](https://portainer.io) and custom made `App Templates`. These include:
*  a `Vanilla Kali`
*  a official `Metasploit-5-dev(Alpine)` build from Rapid7
* `Damn Vulnerable Web Application (DVWA)`, which is very well documented to try out offensive web attacks
* `ZAP Proxy` container for convenience


## Pre requisites

To deploy the **portainer pentest lab** make sure you have `docker` and `docker-compose` installed first.

## Deploy

### Fetch

#### Use the ready-made portainer fork
```bash

> git clone git@gitlab.com:akka-infosec/ceh-portainer.git
> cd ceh-portainer
```

#### Use the vanilla portainer build

First pull the official portainer dedicated `docker-compose` repository

```bash
> git clone https://github.com/portainer/portainer-compose.git
``` 

Modify the `docker-compose.yml` file to point to the custom App Template. 

```bash
> cd ceh-portainer
> nano docker-compose.yml
```

Replace 

```
command: --templates http://templates/templates.json
```

by 

```
command: --templates https://raw.githubusercontent.com/khast3x/portainer-pentest-lab/master/templates.yml --host=unix:///var/run/docker.sock
```

In some instances, the `watchtower` module that is summoned by the docker-compose file can cause some problems. You can safely remove it.

You can check that your modifications did not break the configuration file by using a [YAML checking tool](http://www.yamllint.com/)

### Test the first run

```bash
> cd ceh-portainer
> docker-compose up

# Make sure everything works by viewing the stdout debug output, then stop the stack

> ^C
```

### Launch as daemon

```bash
> docker-compose up -d
```

## Usage

### Accessing Portainer UI

* Open your web browser to `http://<IP>/portainer` where *IP* is either your localhost or the hosted server's *public* IP.

* Set your Web UI password
* Choose the single *enpoint* presented by the interface

### Starting the Pentest lab

Head over to **App Templates** in the left menu, represented by a rocket :rocket:

#### DVWA - Damn Vulnerable Web Application 

Select the *DVWA* Template. The default configuration will bind *DVWA* to port `<IP>:8082`.

If you wish to change the deploy port, click on the `+ Show advanced options` and remap the left (host) value.  
Select `Deploy the container`, wait for it to finish, and head over the appropriate `IP:PORT` (`8082` if default).

Once the container started, here are the final steps **before** getting started:

* Generate the database by simply clicking on the `Create / Reset Database`
* Login using `admin/password` credentials
* Click on the `DVWA Security` button in the left menu
* Set `Security Level` to your appropriate difficulty level. I recommend starting on `Low` and *Submit*

:dart: Hack away!
